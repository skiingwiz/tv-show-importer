import java.text.SimpleDateFormat
import org.apache.tools.ant.filters.ReplaceTokens

plugins {
  id 'java'
  id 'eclipse'
}

sourceSets {
    scripts
}

dependencies {
   testCompile group: 'junit', name: 'junit', version: '4.12+'
}

repositories {
   mavenCentral()
   jcenter()
}

version = '1.1.6'

processResources{
    filter ReplaceTokens, tokens:['version': version]
 }

task publish(type: Zip, dependsOn: [build, processScriptsResources]) {
    configurations.runtime.allDependencies.each {
        it.path
    }
    
    from tasks.jar.outputs.files
    from tasks.processScriptsResources.outputs.files
}

jar {
   manifest {
      attributes(
          'Main-Class': 'main.Main',
          'Built-By': System.properties['user.name'],
          'Built-At': now('dd-MMM-yyyy HH:mm:ss'),
          'Implementation-Version': version
      )
   }
}

private String now(String format) {
   return new SimpleDateFormat(format).format(new Date())
}
